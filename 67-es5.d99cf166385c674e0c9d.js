function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var a=0;a<e.length;a++){var c=e[a];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(t,c.key,c)}}function _createClass(t,e,a){return e&&_defineProperties(t.prototype,e),a&&_defineProperties(t,a),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{Fnjz:function(t,e,a){"use strict";a.r(e),a.d(e,"UploadcatalogPageModule",(function(){return B}));var c=a("ofXK"),i=a("3Pt+"),r=a("tyNb"),s=a("TEn/"),o=a("7pIB"),n=a("pwB6"),d=a("DVUX"),u=a("6233"),l=a("fXoL"),p=a("gren"),g=a("P6Fj"),h=a("NFeN"),y=a("hV0v"),f=a("sYmb");function v(t,e){if(1&t){var a=l.ic();l.hc(0,"div",8),l.hc(1,"input",9,10),l.pc("change",(function(t){return l.Nc(a),l.tc(2).previewFile(t)})),l.gc(),l.hc(3,"button",11),l.pc("click",(function(){return l.Nc(a),l.Kc(2).click()})),l.hc(4,"mat-icon",12),l.Xc(5,"extension"),l.gc(),l.Xc(6),l.uc(7,"translate"),l.gc(),l.gc()}if(2&t){var c=l.tc(2);l.Ob(1),l.Cc("uploader",c.uploader),l.Ob(5),l.Zc(" ",l.vc(7,2,"Add Products Catalog")," ")}}function b(t,e){if(1&t){var a=l.ic();l.hc(0,"div",13),l.hc(1,"button",14),l.pc("click",(function(){return l.Nc(a),l.tc(2).clearAllItems()})),l.hc(2,"mat-icon",12),l.Xc(3,"delete"),l.gc(),l.Xc(4),l.uc(5,"translate"),l.gc(),l.hc(6,"button",11),l.pc("click",(function(){return l.Nc(a),l.tc(2).saveAllItems()})),l.hc(7,"mat-icon",12),l.Xc(8,"save"),l.gc(),l.Xc(9),l.uc(10,"translate"),l.gc(),l.gc()}2&t&&(l.Ob(4),l.Zc(" ",l.vc(5,2,"Clear All Products")," "),l.Ob(5),l.Zc(" ",l.vc(10,4,"Save All Products")," "))}function m(t,e){if(1&t){var a=l.ic();l.hc(0,"app-productcard-grandbazar",15),l.pc("actionevent",(function(t){return l.Nc(a),l.tc(2).perform(t)})),l.gc()}if(2&t){var c=e.$implicit,i=l.tc(2);l.Cc("product",c)("productlist",i.crudList)("onpage","uploadcatalog")("catalogupload",!0)}}function k(t,e){if(1&t&&(l.hc(0,"ion-content",3),l.Vc(1,v,8,4,"div",4),l.Vc(2,b,11,6,"div",5),l.hc(3,"ion-item"),l.Xc(4),l.gc(),l.hc(5,"div",6),l.Vc(6,m,1,4,"app-productcard-grandbazar",7),l.gc(),l.gc()),2&t){var a=l.tc();l.Ob(1),l.Cc("ngIf",a.clearme),l.Ob(1),l.Cc("ngIf",a.products.length>0),l.Ob(2),l.ad(' You are using "',a.ygen.getSubscriptionType(),'" subscription; You can add max ',a.ygen.maxproductsCanAdded()," products; "),l.Ob(2),l.Cc("ngForOf",a.products)}}var C,P,U=((C=function(){function t(e,a,c,i,r,s,o,n,d,u){_classCallCheck(this,t),this.ngxUiLoaderService=e,this.firedb=a,this.centerdb=c,this.ycat=i,this.toast=r,this.ydata=s,this.ygen=o,this.papa=n,this.yalert=d,this.photoUploadService=u,this.clearme=!0,this.productlimit=50,this.products=[],this.recievedCategoryListKeyVal={},this.checkCategoryMap={},this.checkBrandMap={},this.showprocessing=!1,this.uploader=u.getUploader(),u.getUploader().clearQueue(),u.getUploader().cancelAll()}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;this.checkCategoryMap={},this.checkBrandMap={},this.centerdb.currenttenant.subscribe((function(e){e&&(t.crudList=new n.p(n.P.getpath()+"/shop/products",t.ydata.getDatabase(),!0,t.ygen.getUid()),t.crudList.getList().subscribe((function(e){t.productlimit=e.length})))})),this.ycat.retrivedCatalog.subscribe((function(e){t.showprocessing=e})),this.ycat.retrivedCatagories.subscribe((function(e){e&&Object.values(e).forEach((function(e){t.checkCategoryMap[e.title]=e}))})),this.ycat.retrivedBrands.subscribe((function(e){e&&Object.values(e).forEach((function(e){e.title&&(t.checkBrandMap[e.title.trim().toUpperCase()]=e)}))}))}},{key:"previewFile",value:function(t){var e=this;t.srcElement&&t.srcElement.files&&t.srcElement.files[0]&&(t.srcElement.files[0].name.includes(".csv")?(this.toast.pop("success","Got the event & processing "+t.target.files.length+" file","Ok"),this.toast.pop("warn","Reading files","Processing"),this.papa.parse(t.srcElement.files[0],{complete:function(t,a){t.errors.forEach((function(e){return t.data.splice(e.row,1)})),t.data.forEach((function(t){t.outofstock=!1,t.soldout=!1;try{t.$key=JSON.parse(t.$key)}catch(s){console.error(t.$key,s)}if(t.isorganic=e.giveflag(t.isorganic),t.istopsaver=e.giveflag(t.istopsaver),t.heavydiscount=e.giveflag(t.heavydiscount),t.newarrival=e.giveflag(t.newarrival),t.isveg=e.giveflag(t.isveg),t.uploaded=e.giveflag(t.uploaded),t.discount=e.getDiscount(t),t.variations){var a=t.variations.replace(/\|/g,",");try{var c=JSON.parse(a),i={},r=0;c.forEach((function(t){i[r]=t,r++})),r>0&&(t.variations=i)}catch(s){t.variations=null}}})),e.products=t.data.filter((function(t){return!t.uploaded}))},delimiter:",",header:!0})):this.yalert.errordata("Only CSV files are allowed"))}},{key:"giveflag",value:function(t){return!!t&&"true"==t.toLowerCase()}},{key:"getDiscount",value:function(t){var e=t.mrp;return(100*(e-t.price)/e).toFixed(0)}},{key:"savewithVariation",value:function(t){var e=this;this.checkCategory(t.category,t.subcategory),this.checkBrand(t.brand);var a=this.ydata.getDatabase().createPushId(),c=t.variations;t.discount=this.getDiscount(t),this.ycat.recievedProductListKeyVal[t.$key]?(a=t.$key,delete t.variations,this.ydata.getDatabase().list(n.P.getpath()+"/shop/products/"+a+"/variations").remove(),this.crudList.updateList(t)):(delete t.$key,delete t.variations,this.crudList.getListRefer().set(a,t)),Object.values(c).forEach((function(t){e.ydata.getDatabase().list(n.P.getpath()+"/shop/products/"+a+"/variations").push(t)}))}},{key:"saveAllItems",value:function(){var t=this;this.ngxUiLoaderService.start(),this.yalert.openSnackBar("Saving All Products at once","Ok"),this.products.forEach((function(e){var a=e.$key;e.discount=t.getDiscount(e),t.ygen.canAddProducts()?e.variations?t.savewithVariation(e):t.saveupdate(e,a):t.yalert.openSnackBar("Reach ".concat(t.productlimit," maxlimit of Products will not be added"),"OK")})),this.clearAllItems()}},{key:"saveItem",value:function(t){this.ngxUiLoaderService.start(),t.discount=this.getDiscount(t),t.variations?(t.category&&(t.category=t.category.trim().toUpperCase()),t.subcategory&&(t.subcategory=t.subcategory.trim().toUpperCase()),t.brand&&(t.brand=t.brand.trim().toUpperCase()),this.savewithVariation(t)):this.saveupdate(t,t.$key),this.ngxUiLoaderService.stop()}},{key:"saveupdate",value:function(t,e){this.checkCategory(t.category,t.subcategory),this.checkBrand(t.brand),t.category&&(t.category=t.category.trim().toUpperCase()),t.subcategory&&(t.subcategory=t.subcategory.trim().toUpperCase()),t.brand&&(t.brand=t.brand.trim().toUpperCase()),this.ycat.recievedProductListKeyVal[e]?this.crudList.updateList(t):this.crudList.addtolist(t)}},{key:"perform",value:function(t){switch(t.what){case"add":t.event.discount=this.getDiscount(t.event),this.saveItem(t.event),this.products=this.products.filter((function(e){return e.$key!=t.event.$key})),this.yalert.openSnackBar("Product saved","Ok");break;case"delete":this.products=this.products.filter((function(e){return e.$key!=t.event.$key})),this.yalert.openSnackBar("Product deleted","Ok");break;case"copy":t.event.discount=this.getDiscount(t.event),this.products.push(t.event),this.yalert.openSnackBar("Product copied","Ok")}}},{key:"clearAllItems",value:function(){var t=this;this.products.length=0,this.clearme=!1,this.ngxUiLoaderService.start(),setTimeout((function(){t.clearme=!0,t.ngxUiLoaderService.stop()}),5e3)}},{key:"issubcatPresent",value:function(t,e){var a={};return!!t.subcategory&&(Object.values(t.subcategory).forEach((function(t){a[t.title]=t})),a[e])}},{key:"checkCategory",value:function(t,e){t&&t.trim().length>0&&!this.checkCategoryMap[t]?this.addCategory(t,e):e&&e.trim().length>0&&!this.issubcatPresent(this.checkCategoryMap[t],e)&&this.addSubcategory(e,this.checkCategoryMap[t].$key,t)}},{key:"checkBrand",value:function(t){t&&t.trim().length>0&&!this.checkBrandMap[t.trim().toUpperCase()]&&(this.checkBrandMap[t.trim().toUpperCase()]="addedd",this.addBrands(t.trim()))}},{key:"addCategory",value:function(t,e){if(n.P.getpath()&&n.P.getpath().length>0&&t&&t.trim().length>0){var a=this.ydata.getDatabase().createPushId(),c={active:!0,createdBy:this.ygen.getUid(),description:"",image:"https://res.cloudinary.com/ideasyogi/image/upload/v1589964651/default_qkhcdj.jpg",imageuploaded:!0,title:t.trim().toUpperCase(),updatedBy:this.ygen.getUid()};this.checkCategoryMap[t]={active:!0,$key:a,createdBy:this.ygen.getUid(),description:"",image:"https://res.cloudinary.com/ideasyogi/image/upload/v1589964651/default_qkhcdj.jpg",imageuploaded:!0,title:t.trim().toUpperCase(),updatedBy:this.ygen.getUid()},this.firedb.list(n.P.getpath()+"/shop/categories/").set(a,c),e&&e.trim().length>0&&this.addSubcategory(e.trim(),a,t)}}},{key:"addSubcategory",value:function(t,e,a){if(console.log("adding key",e),n.P.getpath()&&n.P.getpath().length>0&&e&&(""+e).length>0){var c={active:!0,createdBy:this.ygen.getUid(),description:"",image:"https://res.cloudinary.com/ideasyogi/image/upload/v1589964651/default_qkhcdj.jpg",imageuploaded:!0,title:t.trim().toUpperCase(),updatedBy:this.ygen.getUid()},i=this.ydata.getDatabase().createPushId(),r={};this.checkCategoryMap[a].subcategory&&(r=this.checkCategoryMap[a].subcategory),r[i]=c,this.checkCategoryMap[a].subcategory=r,this.firedb.list(n.P.getpath()+"/shop/categories/"+e+"/subcategory").set(i,c)}}},{key:"addBrands",value:function(t){if(n.P.getpath()&&n.P.getpath().length>0){var e=this.ydata.getDatabase().createPushId(),a={active:!0,createdBy:this.ygen.getUid(),description:"",image:"https://res.cloudinary.com/ideasyogi/image/upload/v1589964651/default_qkhcdj.jpg",imageuploaded:!0,title:t.trim().toUpperCase(),updatedBy:this.ygen.getUid()};this.firedb.list(n.P.getpath()+"/shop/brands").set(e,a)}}}]),t}()).\u0275fac=function(t){return new(t||C)(l.bc(p.c),l.bc(u.AngularFireDatabase),l.bc(n.P),l.bc(n.O),l.bc(d.d),l.bc(n.Q),l.bc(n.T),l.bc(g.a),l.bc(n.a),l.bc(n.cb))},C.\u0275cmp=l.Vb({type:C,selectors:[["app-uploadcatalog"]],decls:8,vars:5,consts:[[3,"color"],["slot","start"],["padding","",4,"ngIf"],["padding",""],["class","addprod",4,"ngIf"],["class","addprodact","style","padding:5px",4,"ngIf"],[1,"productlist"],[3,"product","productlist","onpage","catalogupload","actionevent",4,"ngFor","ngForOf"],[1,"addprod"],["hidden","","type","file","ng2FileSelect","",3,"uploader","change"],["productsFileInput",""],[1,"mat-raised-button","mat-primary",3,"click"],["color","warm",1,"pointer"],[1,"addprodact",2,"padding","5px"],[1,"mat-raised-button","mat-secondary",3,"click"],[3,"product","productlist","onpage","catalogupload","actionevent"]],template:function(t,e){1&t&&(l.hc(0,"ion-header"),l.hc(1,"ion-toolbar",0),l.hc(2,"ion-buttons",1),l.cc(3,"ion-back-button"),l.gc(),l.hc(4,"ion-title"),l.Xc(5),l.uc(6,"translate"),l.gc(),l.gc(),l.gc(),l.Vc(7,k,7,5,"ion-content",2)),2&t&&(l.Ob(1),l.Cc("color","warning"),l.Ob(4),l.Yc(l.vc(6,3,"Upload Product Catalog")),l.Ob(2),l.Cc("ngIf",e.showprocessing&&e.clearme))},directives:[s.y,s.hb,s.j,s.f,s.g,s.fb,c.m,s.s,s.D,c.l,o.a,h.a,y.a],pipes:[f.c],styles:[".productlist[_ngcontent-%COMP%]{flex-direction:row;flex-wrap:wrap;align-items:stretch}.addprod[_ngcontent-%COMP%], .productlist[_ngcontent-%COMP%]{display:flex;justify-content:center}.addprod[_ngcontent-%COMP%]{padding:10px}.addprodact[_ngcontent-%COMP%]{display:flex;justify-content:space-around}"]}),C),w=a("uUdd"),O=[{path:"",component:U}],B=((P=function t(){_classCallCheck(this,t)}).\u0275mod=l.Zb({type:P}),P.\u0275inj=l.Yb({factory:function(t){return new(t||P)},imports:[[c.c,i.j,s.ib,n.H,n.o,n.b,o.b,w.a,r.n.forChild(O)]]}),P)}}]);