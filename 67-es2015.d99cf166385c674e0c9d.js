(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{Fnjz:function(t,e,a){"use strict";a.r(e),a.d(e,"UploadcatalogPageModule",(function(){return O}));var i=a("ofXK"),c=a("3Pt+"),s=a("tyNb"),r=a("TEn/"),o=a("7pIB"),d=a("pwB6"),n=a("DVUX"),p=a("6233"),h=a("fXoL"),g=a("gren"),l=a("P6Fj"),u=a("NFeN"),y=a("hV0v"),b=a("sYmb");function v(t,e){if(1&t){const t=h.ic();h.hc(0,"div",8),h.hc(1,"input",9,10),h.pc("change",(function(e){return h.Nc(t),h.tc(2).previewFile(e)})),h.gc(),h.hc(3,"button",11),h.pc("click",(function(){return h.Nc(t),h.Kc(2).click()})),h.hc(4,"mat-icon",12),h.Xc(5,"extension"),h.gc(),h.Xc(6),h.uc(7,"translate"),h.gc(),h.gc()}if(2&t){const t=h.tc(2);h.Ob(1),h.Cc("uploader",t.uploader),h.Ob(5),h.Zc(" ",h.vc(7,2,"Add Products Catalog")," ")}}function m(t,e){if(1&t){const t=h.ic();h.hc(0,"div",13),h.hc(1,"button",14),h.pc("click",(function(){return h.Nc(t),h.tc(2).clearAllItems()})),h.hc(2,"mat-icon",12),h.Xc(3,"delete"),h.gc(),h.Xc(4),h.uc(5,"translate"),h.gc(),h.hc(6,"button",11),h.pc("click",(function(){return h.Nc(t),h.tc(2).saveAllItems()})),h.hc(7,"mat-icon",12),h.Xc(8,"save"),h.gc(),h.Xc(9),h.uc(10,"translate"),h.gc(),h.gc()}2&t&&(h.Ob(4),h.Zc(" ",h.vc(5,2,"Clear All Products")," "),h.Ob(5),h.Zc(" ",h.vc(10,4,"Save All Products")," "))}function f(t,e){if(1&t){const t=h.ic();h.hc(0,"app-productcard-grandbazar",15),h.pc("actionevent",(function(e){return h.Nc(t),h.tc(2).perform(e)})),h.gc()}if(2&t){const t=e.$implicit,a=h.tc(2);h.Cc("product",t)("productlist",a.crudList)("onpage","uploadcatalog")("catalogupload",!0)}}function k(t,e){if(1&t&&(h.hc(0,"ion-content",3),h.Vc(1,v,8,4,"div",4),h.Vc(2,m,11,6,"div",5),h.hc(3,"ion-item"),h.Xc(4),h.gc(),h.hc(5,"div",6),h.Vc(6,f,1,4,"app-productcard-grandbazar",7),h.gc(),h.gc()),2&t){const t=h.tc();h.Ob(1),h.Cc("ngIf",t.clearme),h.Ob(1),h.Cc("ngIf",t.products.length>0),h.Ob(2),h.ad(' You are using "',t.ygen.getSubscriptionType(),'" subscription; You can add max ',t.ygen.maxproductsCanAdded()," products; "),h.Ob(2),h.Cc("ngForOf",t.products)}}let C=(()=>{class t{constructor(t,e,a,i,c,s,r,o,d,n){this.ngxUiLoaderService=t,this.firedb=e,this.centerdb=a,this.ycat=i,this.toast=c,this.ydata=s,this.ygen=r,this.papa=o,this.yalert=d,this.photoUploadService=n,this.clearme=!0,this.productlimit=50,this.products=[],this.recievedCategoryListKeyVal={},this.checkCategoryMap={},this.checkBrandMap={},this.showprocessing=!1,this.uploader=n.getUploader(),n.getUploader().clearQueue(),n.getUploader().cancelAll()}ngOnInit(){this.checkCategoryMap={},this.checkBrandMap={},this.centerdb.currenttenant.subscribe(t=>{t&&(this.crudList=new d.p(d.P.getpath()+"/shop/products",this.ydata.getDatabase(),!0,this.ygen.getUid()),this.crudList.getList().subscribe(t=>{this.productlimit=t.length}))}),this.ycat.retrivedCatalog.subscribe(t=>{this.showprocessing=t}),this.ycat.retrivedCatagories.subscribe(t=>{t&&Object.values(t).forEach(t=>{this.checkCategoryMap[t.title]=t})}),this.ycat.retrivedBrands.subscribe(t=>{t&&Object.values(t).forEach(t=>{t.title&&(this.checkBrandMap[t.title.trim().toUpperCase()]=t)})})}previewFile(t){t.srcElement&&t.srcElement.files&&t.srcElement.files[0]&&(t.srcElement.files[0].name.includes(".csv")?(this.toast.pop("success","Got the event & processing "+t.target.files.length+" file","Ok"),this.toast.pop("warn","Reading files","Processing"),this.papa.parse(t.srcElement.files[0],{complete:(t,e)=>{t.errors.forEach(e=>t.data.splice(e.row,1)),t.data.forEach(t=>{t.outofstock=!1,t.soldout=!1;try{t.$key=JSON.parse(t.$key)}catch(e){console.error(t.$key,e)}if(t.isorganic=this.giveflag(t.isorganic),t.istopsaver=this.giveflag(t.istopsaver),t.heavydiscount=this.giveflag(t.heavydiscount),t.newarrival=this.giveflag(t.newarrival),t.isveg=this.giveflag(t.isveg),t.uploaded=this.giveflag(t.uploaded),t.discount=this.getDiscount(t),t.variations){let a=t.variations.replace(/\|/g,",");try{let e=JSON.parse(a),i={},c=0;e.forEach(t=>{i[c]=t,c++}),c>0&&(t.variations=i)}catch(e){t.variations=null}}}),this.products=t.data.filter(t=>!t.uploaded)},delimiter:",",header:!0})):this.yalert.errordata("Only CSV files are allowed"))}giveflag(t){return!!t&&"true"==t.toLowerCase()}getDiscount(t){let e=t.mrp;return(100*(e-t.price)/e).toFixed(0)}savewithVariation(t){this.checkCategory(t.category,t.subcategory),this.checkBrand(t.brand);let e=this.ydata.getDatabase().createPushId(),a=t.variations;t.discount=this.getDiscount(t),this.ycat.recievedProductListKeyVal[t.$key]?(e=t.$key,delete t.variations,this.ydata.getDatabase().list(d.P.getpath()+"/shop/products/"+e+"/variations").remove(),this.crudList.updateList(t)):(delete t.$key,delete t.variations,this.crudList.getListRefer().set(e,t)),Object.values(a).forEach(t=>{this.ydata.getDatabase().list(d.P.getpath()+"/shop/products/"+e+"/variations").push(t)})}saveAllItems(){this.ngxUiLoaderService.start(),this.yalert.openSnackBar("Saving All Products at once","Ok"),this.products.forEach(t=>{let e=t.$key;t.discount=this.getDiscount(t),this.ygen.canAddProducts()?t.variations?this.savewithVariation(t):this.saveupdate(t,e):this.yalert.openSnackBar(`Reach ${this.productlimit} maxlimit of Products will not be added`,"OK")}),this.clearAllItems()}saveItem(t){this.ngxUiLoaderService.start(),t.discount=this.getDiscount(t),t.variations?(t.category&&(t.category=t.category.trim().toUpperCase()),t.subcategory&&(t.subcategory=t.subcategory.trim().toUpperCase()),t.brand&&(t.brand=t.brand.trim().toUpperCase()),this.savewithVariation(t)):this.saveupdate(t,t.$key),this.ngxUiLoaderService.stop()}saveupdate(t,e){this.checkCategory(t.category,t.subcategory),this.checkBrand(t.brand),t.category&&(t.category=t.category.trim().toUpperCase()),t.subcategory&&(t.subcategory=t.subcategory.trim().toUpperCase()),t.brand&&(t.brand=t.brand.trim().toUpperCase()),this.ycat.recievedProductListKeyVal[e]?this.crudList.updateList(t):this.crudList.addtolist(t)}perform(t){switch(t.what){case"add":t.event.discount=this.getDiscount(t.event),this.saveItem(t.event),this.products=this.products.filter(e=>e.$key!=t.event.$key),this.yalert.openSnackBar("Product saved","Ok");break;case"delete":this.products=this.products.filter(e=>e.$key!=t.event.$key),this.yalert.openSnackBar("Product deleted","Ok");break;case"copy":t.event.discount=this.getDiscount(t.event),this.products.push(t.event),this.yalert.openSnackBar("Product copied","Ok")}}clearAllItems(){this.products.length=0,this.clearme=!1,this.ngxUiLoaderService.start(),setTimeout(()=>{this.clearme=!0,this.ngxUiLoaderService.stop()},5e3)}issubcatPresent(t,e){let a={};return!!t.subcategory&&(Object.values(t.subcategory).forEach(t=>{a[t.title]=t}),a[e])}checkCategory(t,e){t&&t.trim().length>0&&!this.checkCategoryMap[t]?this.addCategory(t,e):e&&e.trim().length>0&&!this.issubcatPresent(this.checkCategoryMap[t],e)&&this.addSubcategory(e,this.checkCategoryMap[t].$key,t)}checkBrand(t){t&&t.trim().length>0&&!this.checkBrandMap[t.trim().toUpperCase()]&&(this.checkBrandMap[t.trim().toUpperCase()]="addedd",this.addBrands(t.trim()))}addCategory(t,e){if(d.P.getpath()&&d.P.getpath().length>0&&t&&t.trim().length>0){let a=this.ydata.getDatabase().createPushId(),i={active:!0,createdBy:this.ygen.getUid(),description:"",image:"https://res.cloudinary.com/ideasyogi/image/upload/v1589964651/default_qkhcdj.jpg",imageuploaded:!0,title:t.trim().toUpperCase(),updatedBy:this.ygen.getUid()};this.checkCategoryMap[t]={active:!0,$key:a,createdBy:this.ygen.getUid(),description:"",image:"https://res.cloudinary.com/ideasyogi/image/upload/v1589964651/default_qkhcdj.jpg",imageuploaded:!0,title:t.trim().toUpperCase(),updatedBy:this.ygen.getUid()},this.firedb.list(d.P.getpath()+"/shop/categories/").set(a,i),e&&e.trim().length>0&&this.addSubcategory(e.trim(),a,t)}}addSubcategory(t,e,a){if(console.log("adding key",e),d.P.getpath()&&d.P.getpath().length>0&&e&&(""+e).length>0){let i={active:!0,createdBy:this.ygen.getUid(),description:"",image:"https://res.cloudinary.com/ideasyogi/image/upload/v1589964651/default_qkhcdj.jpg",imageuploaded:!0,title:t.trim().toUpperCase(),updatedBy:this.ygen.getUid()},c=this.ydata.getDatabase().createPushId(),s={};this.checkCategoryMap[a].subcategory&&(s=this.checkCategoryMap[a].subcategory),s[c]=i,this.checkCategoryMap[a].subcategory=s,this.firedb.list(d.P.getpath()+"/shop/categories/"+e+"/subcategory").set(c,i)}}addBrands(t){if(d.P.getpath()&&d.P.getpath().length>0){let e=this.ydata.getDatabase().createPushId(),a={active:!0,createdBy:this.ygen.getUid(),description:"",image:"https://res.cloudinary.com/ideasyogi/image/upload/v1589964651/default_qkhcdj.jpg",imageuploaded:!0,title:t.trim().toUpperCase(),updatedBy:this.ygen.getUid()};this.firedb.list(d.P.getpath()+"/shop/brands").set(e,a)}}}return t.\u0275fac=function(e){return new(e||t)(h.bc(g.c),h.bc(p.AngularFireDatabase),h.bc(d.P),h.bc(d.O),h.bc(n.d),h.bc(d.Q),h.bc(d.T),h.bc(l.a),h.bc(d.a),h.bc(d.cb))},t.\u0275cmp=h.Vb({type:t,selectors:[["app-uploadcatalog"]],decls:8,vars:5,consts:[[3,"color"],["slot","start"],["padding","",4,"ngIf"],["padding",""],["class","addprod",4,"ngIf"],["class","addprodact","style","padding:5px",4,"ngIf"],[1,"productlist"],[3,"product","productlist","onpage","catalogupload","actionevent",4,"ngFor","ngForOf"],[1,"addprod"],["hidden","","type","file","ng2FileSelect","",3,"uploader","change"],["productsFileInput",""],[1,"mat-raised-button","mat-primary",3,"click"],["color","warm",1,"pointer"],[1,"addprodact",2,"padding","5px"],[1,"mat-raised-button","mat-secondary",3,"click"],[3,"product","productlist","onpage","catalogupload","actionevent"]],template:function(t,e){1&t&&(h.hc(0,"ion-header"),h.hc(1,"ion-toolbar",0),h.hc(2,"ion-buttons",1),h.cc(3,"ion-back-button"),h.gc(),h.hc(4,"ion-title"),h.Xc(5),h.uc(6,"translate"),h.gc(),h.gc(),h.gc(),h.Vc(7,k,7,5,"ion-content",2)),2&t&&(h.Ob(1),h.Cc("color","warning"),h.Ob(4),h.Yc(h.vc(6,3,"Upload Product Catalog")),h.Ob(2),h.Cc("ngIf",e.showprocessing&&e.clearme))},directives:[r.y,r.hb,r.j,r.f,r.g,r.fb,i.m,r.s,r.D,i.l,o.a,u.a,y.a],pipes:[b.c],styles:[".productlist[_ngcontent-%COMP%]{flex-direction:row;flex-wrap:wrap;align-items:stretch}.addprod[_ngcontent-%COMP%], .productlist[_ngcontent-%COMP%]{display:flex;justify-content:center}.addprod[_ngcontent-%COMP%]{padding:10px}.addprodact[_ngcontent-%COMP%]{display:flex;justify-content:space-around}"]}),t})();var P=a("uUdd");const U=[{path:"",component:C}];let O=(()=>{class t{}return t.\u0275mod=h.Zb({type:t}),t.\u0275inj=h.Yb({factory:function(e){return new(e||t)},imports:[[i.c,c.j,r.ib,d.H,d.o,d.b,o.b,P.a,s.n.forChild(U)]]}),t})()}}]);